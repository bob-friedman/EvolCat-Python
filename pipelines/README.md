## Scripts for Virus Biology and Analysis

> Welcome to the Pipelines page in the EvolCat-Python project. This section provides a collection of scripts and guides covering everything from core virology concepts to advanced bioinformatic pipelines. The files in this directory are structured as guides so their purpose is described in the Guides section. The descriptions below are specific to the scripts in extras/ which are sample code to extend a Python-based pipeline.
---

## ðŸ“– Scripts in Extras/

*   [**retrieve_attention_scores.py**](./extras/retrieve_attention_scores.py):
    *   *This Python script retrieves attention scores from a pre-trained seq2seq Transformer model. It takes pairs of sequence data (ancestor-descendant) as input. The script outputs a CSV file containing these attention scores, which can then be utilized for further analyses, such as correlating them with other biological data. For a more detailed explanation of attention scores and their utility, please see the [Attention Scores Document](attention_scores.md).*
	
*   [**sasa_analysis.py**](./extras/sasa_analysis.py):
    *   *This Python script is designed to analyze data from the IEDB (Immune Epitope Database), with a specific focus on B cell epitopes. It performs statistical analyses, including correlating attention scores obtained from `retrieve_attention_scores.py` with [Solvent Accessible Surface Area (SASA)](SASA.md). This helps determine if residues located on the protein surface tend to receive more attention from the model.*
	
*   [**tree_visualization.py**](./extras/tree_visualization.py):
    *   *This Python script accepts a bootstrap consensus tree file (commonly generated by tools like IQ-TREE) as input. It generates an ASCII-based visualization of the phylogenetic tree, clearly displaying bootstrap support values on the internal nodes. While tools like FigTree (Java-based) are available for creating publication-quality images, this script provides a quick and convenient method for text-based tree visualization.*

---
## ðŸ§¬ Main Pipeline Scripts

*   [**protein_language_model_analysis.py**](./protein_language_model_analysis.py):
    *   **Purpose**: Analyzes protein sequences using a pre-trained protein language model (ESM-2).
    *   **Functionality**:
        *   Loads baseline and target variant sequences from FASTA files.
        *   Calculates semantic change (embedding cosine similarity) and grammaticality (log-likelihood) for variants relative to a baseline.
        *   Identifies specific "past" (e.g., Delta) and "future" (e.g., Omicron) variants.
        *   Generates hypothetical random mutants from the "past" variant.
        *   Compares the "future" variant against the "past" variant and hypothetical mutants.
        *   Visualizes results with a scatter plot (semantic change vs. grammaticality).
        *   Includes a module for generating a fitness heatmap from relevant data.
    *   **Input**:
        *   Baseline protein sequence FASTA file.
        *   Target protein variant sequences FASTA file.
        *   (For heatmap): A pandas DataFrame `df` with 'mutation', 'position', 'fitness' columns.
    *   **Output**:
        *   Console output with calculated metrics and analysis progress.
        *   Scatter plot image file (e.g., `predictive_analysis_plot.png`).
        *   Fitness heatmap image file (e.g., `fitness_heatmap.png`), if data provided.
    *   **Key Dependencies**: `torch`, `transformers`, `biopython`, `numpy`, `pandas`, `matplotlib`, `seaborn`, `tqdm`.
    *   **Note**: File paths for FASTA files can be specified via command-line arguments or will default to example files in an `examples/` subdirectory. The heatmap requires specific input data.

*   [**evolutionary_data_retrieval.py**](./evolutionary_data_retrieval.py):
    *   **Purpose**: Retrieves and analyzes homologous protein sequences to provide evolutionary context.
    *   **Functionality**:
        *   Performs a BLASTp search against NCBI 'nr' database with a query sequence.
        *   Parses BLAST XML output to extract homologous sequences.
        *   Generates a Multiple Sequence Alignment (MSA) using MAFFT (external tool).
        *   Calculates per-position conservation scores from the MSA.
        *   Fetches a PDB file and uses DSSP (external tool) to calculate Relative Solvent Accessibility (RSA).
        *   Computes a "Burial Score" (1 - RSA) and merges it with conservation data.
        *   Calculates a normalized Physicochemical Score (P-score) for amino acid substitutions using BLOSUM62 matrix, indicating mutation radicalness.
    *   **Input**:
        *   Target protein sequence (can be hardcoded default or provided).
        *   PDB ID (e.g., "7VYR") for structural analysis.
        *   Chain ID and residue range for DSSP analysis on the PDB structure.
    *   **Output**:
        *   `blast_results.xml`: Raw BLAST output.
        *   `unaligned_sequences.fasta`: Homologous sequences pre-alignment.
        *   `aligned_sequences.fasta`: MSA file.
        *   PDB file (e.g., `7vyr.pdb`).
        *   Console output with progress and data summaries.
        *   A pandas DataFrame (printed and can be saved) with position, reference AA, conservation score, RSA, and burial score.
    *   **Key Dependencies**: `biopython`, `pandas`.
    *   **System Dependencies**: `mafft`, `mkdssp` (DSSP). These must be installed and accessible in the system PATH.
    *   **Note**: This script involves external calls (NCBI, MAFFT, DSSP) and file operations. Ensure network access and correct installation of system dependencies.
